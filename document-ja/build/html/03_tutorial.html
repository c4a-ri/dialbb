<!DOCTYPE html>
<html class="writer-html5" lang="ja" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3. チュートリアル &mdash; DialBB ver. 1.0 ドキュメント v1.0.0 ドキュメント</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/translations.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="next" title="4. フレームワーク仕様" href="04_framework.html" />
    <link rel="prev" title="2. DialBBの概要" href="02_concept.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            DialBB ver. 1.0 ドキュメント
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_intro.html">1. はじめに</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_concept.html">2. DialBBの概要</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. チュートリアル</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">3.1. はじめに</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">3.2. オウム返しサンプルアプリケーション</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">3.2.1. 説明</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">3.2.2. デバッグモード</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#chatgpt">3.3. ChatGPT対話アプリケーション</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">3.3.1. 説明</a></li>
<li class="toctree-l3"><a class="reference internal" href="#app-development-with-chatgpt-app">3.3.2. ChatGPTアプリケーションを利用したアプリケーション作成</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id8">3.4. シンプルアプリケーション</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">3.4.1. システム構成</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">3.4.2. アプリケーションを構成するファイル</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lr-crf-understander">3.4.3. LR-CRF Understanderブロック</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id11">3.4.3.1. 言語理解結果</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">3.4.3.2. 言語理解知識</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">3.4.3.3. 言語理解モデルの構築と利用</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#stn-manager">3.4.4. STN Managerブロック</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id14">3.4.4.1. 概要</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">3.4.4.2. シナリオ記述</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">3.4.4.3. 条件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">3.4.4.4. アクション</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id18">3.4.4.5. 遷移の記述のまとめ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id19">3.4.4.6. 特殊な状態名</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id20">3.4.4.7. シナリオグラフ</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#n-best">3.4.5. N-Best言語理解結果の利用</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">3.4.6. シンプルアプリケーションを利用したアプリケーション構築</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id22">3.4.6.1. 概要</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id23">3.4.6.2. 変更するファイル</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id24">3.5. 実験アプリケーション</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id25">3.5.1. 概要</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id26">3.5.2. アプリケーションを構成するファイル</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id27">3.5.3. ChatGPT言語理解ブロック</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id28">3.5.4. ChatGPT固有表現抽出ブロック</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id29">3.5.4.1. 固有表現抽出知識</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id30">3.5.5. STN Managerの機能</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id31">3.5.5.1. システム発話中の関数呼び出し・特殊変数参照</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id32">3.5.5.2. シンタクスシュガー</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id33">3.5.5.3. リアクション発話生成</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id34">3.5.5.4. ChatGPTを用いた発話生成・条件判定</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id35">3.5.5.5. サブダイアローグ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id36">3.5.5.6. スキップ遷移</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id37">3.5.5.7. リピート機能</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id38">3.5.5.8. 音声入力に対処するための機能</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="04_framework.html">4. フレームワーク仕様</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_builtin_blocks.html">5. 組み込みブロッククラスの仕様</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_appendix.html">6. Appendix</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">DialBB ver. 1.0 ドキュメント</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">3. </span>チュートリアル</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/03_tutorial.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1><span class="section-number">3. </span>チュートリアル<a class="headerlink" href="#id1" title="この見出しへのパーマリンク"></a></h1>
<section id="id2">
<h2><span class="section-number">3.1. </span>はじめに<a class="headerlink" href="#id2" title="この見出しへのパーマリンク"></a></h2>
<p>DialBBにはいくつかのサンプルアプリケーションが付属しています．本章ではこれらのうち，日本語のアプリケーションを用いて，DialBBのアプリケーションの構成と，DialBBを用いてアプリケーションを構築する方法を説明します．</p>
<p>これらのアプリケーションの動作のさせ方は<a class="reference external" href="https://github.com/c4a-ri/dialbb/blob/main/README-ja.md">README</a>を見てください．</p>
</section>
<section id="id3">
<h2><span class="section-number">3.2. </span>オウム返しサンプルアプリケーション<a class="headerlink" href="#id3" title="この見出しへのパーマリンク"></a></h2>
<section id="id4">
<h3><span class="section-number">3.2.1. </span>説明<a class="headerlink" href="#id4" title="この見出しへのパーマリンク"></a></h3>
<p>ただオウム返しを行うアプリケーションです．組み込みブロッククラスは使っていません．</p>
<p><code class="docutils literal notranslate"><span class="pre">sample_apps/parrot</span></code>にあります．</p>
<p><code class="docutils literal notranslate"><span class="pre">sample_apps/parrot/config.yml</span></code>が，このアプリケーションを規定するコンフィギュレーションファイルで，その内容は以下のようになっています．</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">blocks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parrot</span>
<span class="w">    </span><span class="nt">block_class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parrot.Parrot</span>
<span class="w">    </span><span class="nt">input</span><span class="p">:</span>
<span class="w">      </span><span class="nt">input_text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user_utterance</span><span class="w">  </span>
<span class="w">      </span><span class="nt">input_aux_data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aux_data</span>
<span class="w">    </span><span class="nt">output</span><span class="p">:</span>
<span class="w">      </span><span class="nt">output_text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system_utterance</span>
<span class="w">      </span><span class="nt">output_aux_data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aux_data</span>
<span class="w">      </span><span class="nt">final</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">final</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">blocks</span></code>は，本アプリケーションで用いるブロックのコンフィギュレーション（<em>ブロックコンフィギュレーション</em>と呼びます）のリストです．本アプリケーションでは，一つのブロックのみを用います．</p>
<p><code class="docutils literal notranslate"><span class="pre">name</span></code>はブロックの名前を指定します．ログで用いられます．</p>
<p><code class="docutils literal notranslate"><span class="pre">block_class</span></code>は，このブロックのクラス名を指定します．このクラスのインスタンスが作られて，メインモジュールと情報をやり取りします．クラス名は，コンフィギュレーションファイルからの相対パスまたは<code class="docutils literal notranslate"><span class="pre">dialbb</span></code>ディレクトリからの相対パスで記述します．</p>
<p>ブロッククラスは，<code class="docutils literal notranslate"><span class="pre">diabb.abstract_block.AbstractBlock</span></code>の子孫クラスでないといけません．</p>
<p><code class="docutils literal notranslate"><span class="pre">input</span></code>はメインモジュールからの情報の受信を規定します．例えば，</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">input_text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user_utteranee</span>
</pre></div>
</div>
<p>は，メインモジュールの<code class="docutils literal notranslate"><span class="pre">blackboard['user_utterane']</span></code>を，ブロッククラスの<code class="docutils literal notranslate"><span class="pre">process</span></code>メソッドの引数（辞書型）の<code class="docutils literal notranslate"><span class="pre">input_text</span></code>要素として参照できることを意味します．</p>
<p><code class="docutils literal notranslate"><span class="pre">output</span></code>はメインモジュールへの情報の送信を規定します．例えば，</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">output_text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system_utterance</span>
</pre></div>
</div>
<p>は，メインモジュールの<code class="docutils literal notranslate"><span class="pre">blackboard['output_text']</span></code>を，ブロッククラスの<code class="docutils literal notranslate"><span class="pre">process</span></code>メソッドの出力（辞書型）の<code class="docutils literal notranslate"><span class="pre">output_text</span></code>要素で上書きまたは追加することを意味しています．</p>
<p>これを図示すると以下のようになります．</p>
<p><img alt="sample-arch" src="_images/parrot-arch-ja.jpg" /></p>
<p>メインモジュールとブロックを結ぶ矢印の上の記号は，左側がメインモジュールのblackboardにおけるキーで，右側がブロックの入出力におけるキーです．</p>
<p>さらに，<code class="docutils literal notranslate"><span class="pre">sample_apps/parrot/parrot.py</span></code>を見ることでDialBBにおけるブロッククラスの概念が理解できると思います．</p>
</section>
<section id="id5">
<h3><span class="section-number">3.2.2. </span>デバッグモード<a class="headerlink" href="#id5" title="この見出しへのパーマリンク"></a></h3>
<p>以下のように，環境変数<code class="docutils literal notranslate"><span class="pre">DIALBB_DEBUG</span></code>に<code class="docutils literal notranslate"><span class="pre">yes</span></code>を設定することにより，ログレベルがデバッグモードになります．</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">DIALBB_DEBUG</span><span class="o">=</span>yes<span class="p">;</span>python<span class="w"> </span>run_server.py<span class="w"> </span>sample_apps/parrot/config.yml
</pre></div>
</div>
<p>これにより，コンソールに詳しいログが出力されますので，それを見ることで理解が深まると思います．</p>
</section>
</section>
<section id="chatgpt">
<h2><span class="section-number">3.3. </span>ChatGPT対話アプリケーション<a class="headerlink" href="#chatgpt" title="この見出しへのパーマリンク"></a></h2>
<section id="id6">
<h3><span class="section-number">3.3.1. </span>説明<a class="headerlink" href="#id6" title="この見出しへのパーマリンク"></a></h3>
<p><a class="reference internal" href="05_builtin_blocks.html#chatgpt-dialogue"><span class="std std-ref">ChatGPT Dialogue （ChatGPTベースの対話ブロック）</span></a>を用い，OpenAIのChatGPTを用いて対話を行います．</p>
<p><code class="docutils literal notranslate"><span class="pre">sample_apps/chatgpt/</span></code>にあります．</p>
<p><code class="docutils literal notranslate"><span class="pre">sample_apps/chatgpt/config_ja.yml</span></code>の内容は以下のようになっています．</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">blocks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chatgpt</span>
<span class="w">    </span><span class="nt">block_class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dialbb.builtin_blocks.chatgpt.chatgpt.ChatGPT</span>
<span class="w">    </span><span class="nt">input</span><span class="p">:</span>
<span class="w">      </span><span class="nt">user_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user_id</span>
<span class="w">      </span><span class="nt">user_utterance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user_utterance</span>
<span class="w">      </span><span class="nt">aux_data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aux_data</span>
<span class="w">    </span><span class="nt">output</span><span class="p">:</span>
<span class="w">      </span><span class="nt">system_utterance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">system_utterance</span>
<span class="w">      </span><span class="nt">aux_data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aux_data</span>
<span class="w">      </span><span class="nt">final</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">final</span>
<span class="w">    </span><span class="nt">user_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ユーザ</span>
<span class="w">    </span><span class="nt">system_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">システム</span>
<span class="w">    </span><span class="nt">first_system_utterance</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;こんにちは．私の名前は由衣です．少しお話させてください．スイーツって好きですか？&quot;</span>
<span class="w">    </span><span class="nt">prompt_template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prompt_template_ja.txt</span>
<span class="w">    </span><span class="nt">gpt_model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpt-4o-mini</span>
</pre></div>
</div>
<p>メインモジュールとの情報の授受を図示すると以下のようになります．</p>
<p><img alt="sample-arch" src="_images/chatgpt-dialogue-arch-ja.jpg" /></p>
<p>ブロックコンフィギュレーションのパラメータとして，<code class="docutils literal notranslate"><span class="pre">input</span></code>，<code class="docutils literal notranslate"><span class="pre">output</span></code>以外にいくつか設定されています．</p>
<p><code class="docutils literal notranslate"><span class="pre">prompt_template</span></code>は，システム発話のプロンプトのテンプレートを指定します．</p>
<p>プロンプトテンプレート<code class="docutils literal notranslate"><span class="pre">sample_apps/chatgpt/prompt_template_ja.txt</span></code>の中身は以下のようになっています．</p>
<div class="highlight-txt notranslate"><div class="highlight"><pre><span></span># タスク説明

- あなたは対話システムで，ユーザと食べ物に関して雑談をしています．あなたの次の発話を50文字以内で生成してください．

# あなたのペルソナ

- 名前は由衣
- 28歳
- 女性
- スイーツ全般が好き
- お酒は飲まない
- IT会社のwebデザイナー
- 独身
- 非常にフレンドリーに話す
- 外交的で陽気

#  状況

- ユーザとは初対面
- ユーザは同年代
- ユーザとは親しい感じで話す

# 対話の流れ

- 自己紹介する
- 自分がスイーツが好きと伝える
- スイーツが好きかどうか聞く
- ユーザがスイーツが好きな場合，どんなスイーツが好きか聞く
- ユーザがスイーツが好きでない場合，なんで好きじゃないのか聞く

# 現在までの対話

@dialogue_history
</pre></div>
</div>
<p>最後の<code class="docutils literal notranslate"><span class="pre">&#64;dialogue_history</span></code>のところに，それまでの対話の履歴が以下のような形式で挿入されます．</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>システム：こんにちは．私の名前は由衣です．少しお話させてください．スイーツって好きですか？
ユーザ：まあまあ好きです
システム：そうなんですね！私も大好きです．どんなスイーツが好きですか？
ユーザ：どっちかというと和菓子が好きなんですよね
</pre></div>
</div>
<p>ここで，「システム」「ユーザ」はコンフィギュレーションの<code class="docutils literal notranslate"><span class="pre">user_name</span></code>, <code class="docutils literal notranslate"><span class="pre">system_name</span></code>で指定したものが使われます．</p>
</section>
<section id="app-development-with-chatgpt-app">
<span id="id7"></span><h3><span class="section-number">3.3.2. </span>ChatGPTアプリケーションを利用したアプリケーション作成<a class="headerlink" href="#app-development-with-chatgpt-app" title="この見出しへのパーマリンク"></a></h3>
<p>このアプリケーションを流用して新しいアプリケーションを作るには以下のようにします．</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sample_apps/chatgpt</span></code>をディレクトリ毎コピーします．DialBBのディレクトリとは全く関係ないディレクトリで構いません．</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">config.yml</span></code>や<code class="docutils literal notranslate"><span class="pre">prompt_template_ja.txt</span></code>をを編集します．これらのファイルの名前を変更しても構いません．</p></li>
<li><p>以下のコマンドで起動します．</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span>&lt;DialBBディレクトリ&gt;<span class="p">;</span>python<span class="w"> </span>run_server.py<span class="w"> </span>&lt;コンフィギュレーションファイル&gt;
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="id8">
<h2><span class="section-number">3.4. </span>シンプルアプリケーション<a class="headerlink" href="#id8" title="この見出しへのパーマリンク"></a></h2>
<p>以下の組み込みブロックを用いたサンプルアプリケーションです．
(v0.9からSnips言語理解を使わないアプリケーションに置き換わりました）</p>
<ul class="simple">
<li><p><a class="reference internal" href="05_builtin_blocks.html#japanese-canonicalizer"><span class="std std-ref">Japanese Canonicalizer （日本語文字列正規化ブロック）</span></a></p></li>
<li><p><a class="reference internal" href="05_builtin_blocks.html#lr-crf-understander"><span class="std std-ref">LR-CRF Understander （ロジスティック回帰と条件付き確率場を用いた言語理解ブロック）</span></a></p></li>
<li><p><a class="reference internal" href="05_builtin_blocks.html#stn-manager"><span class="std std-ref">STN manager （状態遷移ネットワークベースの対話管理ブロック）</span></a></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">sample_apps/simple_ja/</span></code>にあります．</p>
<section id="id9">
<h3><span class="section-number">3.4.1. </span>システム構成<a class="headerlink" href="#id9" title="この見出しへのパーマリンク"></a></h3>
<p>本アプリケーションは以下のようなシステム構成をしています．</p>
<p><img alt="sample-arch" src="_images/simple-app-arch-ja.jpg" /></p>
<p>本アプリケーションでは，以下の3つの組み込みブロックを利用しています．これらの組み込みブロックの詳細は，<a class="reference internal" href="05_builtin_blocks.html#builtin-blocks"><span class="std std-numref">5 章</span></a>で説明します．</p>
<ul class="simple">
<li><p>Japanese Canonicalizer: ユーザ入力文の正規化（大文字→小文字，全角→半角の変換，Unicode正規化など）を行います．</p></li>
<li><p>LR-CRF Understander: 言語理解を行います．ロジスティック回帰 (Logistic Regression) と条件付き確率場(Conditional Random Fields) を利用して，ユーザ発話タイプ（インテントとも呼びます）の決定とスロットの抽出を行います．</p></li>
<li><p>STN Manager: 対話管理と言語生成を行います．状態遷移ネットワーク(State Transition Network)を用いて対話管理を行い，システム発話を出力します．</p></li>
</ul>
</section>
<section id="id10">
<h3><span class="section-number">3.4.2. </span>アプリケーションを構成するファイル<a class="headerlink" href="#id10" title="この見出しへのパーマリンク"></a></h3>
<p>本アプリケーションを構成するファイルは<code class="docutils literal notranslate"><span class="pre">sample_apps/simple_ja</span></code>ディレクトリ（フォルダ）にあります．</p>
<p><code class="docutils literal notranslate"><span class="pre">sample_apps/simple_ja</span></code>には以下のファイルが含まれています．</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">config.yml</span></code></p>
<p>アプリケーションを規定するコンフィギュレーションファイルです．どのようなブロックを使うかや，各ブロックが読み込むファイルなどが指定されています．このファイルのフォーマットは<a class="reference internal" href="04_framework.html#configuration"><span class="std std-numref">4.3 章</span></a>で詳細に説明します．</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">config_gs_template.yml</span></code></p>
<p>LR-CRF UnderstanderブロックとSTN Manageブロックで用いる知識をExcelではなく，Google Spreadsheetを用いる場合のコンフィギュレーションファイルのテンプレートです．これをコピーし，Google Spreadsheetにアクセスするための情報を加えることで使用できます．</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">simple-nlu-knowledge-ja.xlsx</span></code></p>
<p>LR-CRF Understanderブロックで用いる知識（言語理解知識）を記述したものです．</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">simple-scenario-ja.xlsx</span></code></p>
<p>STN Managerブロックで用いる知識（シナリオ）を記述したものです．</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">scenario_functions.py</span></code></p>
<p>STN Managerブロックで用いるプログラムです</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">test_inputs.txt</span></code></p>
<p>システムテストで使うテストシナリオです．</p>
</li>
</ul>
</section>
<section id="lr-crf-understander">
<h3><span class="section-number">3.4.3. </span>LR-CRF Understanderブロック<a class="headerlink" href="#lr-crf-understander" title="この見出しへのパーマリンク"></a></h3>
<section id="id11">
<h4><span class="section-number">3.4.3.1. </span>言語理解結果<a class="headerlink" href="#id11" title="この見出しへのパーマリンク"></a></h4>
<p>LR-CRF Understanderブロックは，入力発話を解析し，言語理解結果を出力します．
言語理解結果はタイプとスロットの集合からなります．</p>
<p>例えば，「好きなのは醤油」の言語理解結果は次のようになります．</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;特定のラーメンが好き&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nt">&quot;slots&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="nt">&quot;好きなラーメン&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;醤油ラーメン&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&quot;特定のラーメンが好き&quot;</span></code>がタイプで，<code class="docutils literal notranslate"><span class="pre">&quot;favarite_ramen&quot;</span></code>スロットの値が<code class="docutils literal notranslate"><span class="pre">&quot;醤油ラーメン&quot;</span></code>です．複数のスロットを持つような発話もあり得ます．</p>
</section>
<section id="id12">
<h4><span class="section-number">3.4.3.2. </span>言語理解知識<a class="headerlink" href="#id12" title="この見出しへのパーマリンク"></a></h4>
<p>LR-CRF Understanderブロックが用いる言語理解用の知識は，<code class="docutils literal notranslate"><span class="pre">simple-nlu-knowledge-ja.xlsx</span></code>に書かれています．言語理解知識の記述法の詳細は<code class="xref std std-numref docutils literal notranslate"><span class="pre">nlu_knowledge</span></code>を参照してください．以下に簡単に説明します．</p>
<p>言語理解知識は，以下の2つのシートからなります．</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>シート名</p></th>
<th class="head"><p>内容</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>utterances</p></td>
<td><p>タイプ毎の発話例と，その発話例から抽出されるべきスロット</p></td>
</tr>
<tr class="row-odd"><td><p>slots</p></td>
<td><p>スロットとエンティティの関係</p></td>
</tr>
</tbody>
</table>
<p>utterancesシートの一部を以下に示します．</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>flag</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>utterance</p></th>
<th class="head"><p>slots</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Y</p></td>
<td><p>肯定</p></td>
<td><p>はい</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>Y</p></td>
<td><p>否定</p></td>
<td><p>そうでもない</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>Y</p></td>
<td><p>特定のラーメンが好き</p></td>
<td><p>豚骨ラーメンが好きです</p></td>
<td><p>好きなラーメン=豚骨ラーメン</p></td>
</tr>
<tr class="row-odd"><td><p>Y</p></td>
<td><p>地方を言う</p></td>
<td><p>荻窪</p></td>
<td><p>地方=荻窪</p></td>
</tr>
<tr class="row-even"><td><p>Y</p></td>
<td><p>ある地方の特定のラーメンが好き</p></td>
<td><p>札幌の味噌ラーメンが好きです</p></td>
<td><p>地方=札幌, 好きなラーメン=味噌ラーメン</p></td>
</tr>
</tbody>
</table>
<p>一行目は「はい」のタイプが「肯定」で，スロットはないことを示しています．「はい」の言語理解結果は以下のようになります．</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w">  </span>
<span class="w">   </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;肯定&quot;</span><span class="w">   </span>
<span class="p">}</span>
</pre></div>
</div>
<p>「札幌の味噌ラーメンが好きです」の言語理解結果は以下のようになります．</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ある地方の特定のラーメンが好き&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="nt">&quot;slots&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="nt">&quot;好きなラーメン&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;味噌ラーメン&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;地方&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;札幌&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">flag</span></code>列は，その行を使用するかどうかをコンフィギュレーションで規定するためのものです．</p>
<p>次に，<code class="docutils literal notranslate"><span class="pre">slots</span></code>シートの内容の一部を以下に示します．</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>flag</p></th>
<th class="head"><p>slot name</p></th>
<th class="head"><p>entity</p></th>
<th class="head"><p>synonyms</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Y</p></td>
<td><p>好きなラーメン</p></td>
<td><p>豚骨ラーメン</p></td>
<td><p>とんこつラーメン，豚骨スープのラーメン，豚骨</p></td>
</tr>
<tr class="row-odd"><td><p>Y</p></td>
<td><p>好きなラーメン</p></td>
<td><p>味噌ラーメン</p></td>
<td><p>みそらーめん，みそ味のラーメン，味噌</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">slot</span> <span class="pre">name</span></code>列はスロット名，<code class="docutils literal notranslate"><span class="pre">entity</span></code>はスロット値，<code class="docutils literal notranslate"><span class="pre">synonyms</span></code>は同義語のリストです．
例えば，一行目は，<code class="docutils literal notranslate"><span class="pre">好きなラーメン</span></code>のスロット値として，<code class="docutils literal notranslate"><span class="pre">とんこつラーメン</span></code>や<code class="docutils literal notranslate"><span class="pre">豚骨</span></code>などが得られた場合，言語理解結果においては，<code class="docutils literal notranslate"><span class="pre">豚骨ラーメン</span></code>に置き換えられる，ということを表しています．</p>
</section>
<section id="id13">
<h4><span class="section-number">3.4.3.3. </span>言語理解モデルの構築と利用<a class="headerlink" href="#id13" title="この見出しへのパーマリンク"></a></h4>
<p>アプリを立ち上げると，上記の知識から，ロジスティック回帰と条件付き確率場のモデルが作られ，実行時に用いられます．</p>
</section>
</section>
<section id="stn-manager">
<h3><span class="section-number">3.4.4. </span>STN Managerブロック<a class="headerlink" href="#stn-manager" title="この見出しへのパーマリンク"></a></h3>
<section id="id14">
<h4><span class="section-number">3.4.4.1. </span>概要<a class="headerlink" href="#id14" title="この見出しへのパーマリンク"></a></h4>
<p>STN Managerブロックは，状態遷移ネットワーク（State-Transition Network）を用いて対話管理と言語生成を行います．状態遷移ネットワークのことをシナリオとも呼びます．シナリオは，<code class="docutils literal notranslate"><span class="pre">simple-scenario-ja.xlsx</span></code>ファイルの<code class="docutils literal notranslate"><span class="pre">scenario</span></code>シートに書かれています．このシートの書き方の詳細は<a class="reference internal" href="05_builtin_blocks.html#scenario"><span class="std std-numref">5.5.2 章</span></a>を参照してください．</p>
</section>
<section id="id15">
<h4><span class="section-number">3.4.4.2. </span>シナリオ記述<a class="headerlink" href="#id15" title="この見出しへのパーマリンク"></a></h4>
<p>シナリオ記述の一部を以下に示します．</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>flag</p></th>
<th class="head"><p>state</p></th>
<th class="head"><p>system  utterance</p></th>
<th class="head"><p>user utterance  example</p></th>
<th class="head"><p>user utterance  type</p></th>
<th class="head"><p>conditions</p></th>
<th class="head"><p>actions</p></th>
<th class="head"><p>next state</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Y</p></td>
<td><p>好き</p></td>
<td><p>豚骨ラーメンとか塩ラーメンなどいろんな種類のラーメンがありますが，どんなラーメンが好きですか？</p></td>
<td><p>豚骨ラーメンが好きです．</p></td>
<td><p>特定のラーメンが好き</p></td>
<td><p>_eq(#好きなラーメン,  &quot;豚骨ラーメン&quot;)</p></td>
<td><p>_set(&amp;topic_ramen,  #好きなラーメン)</p></td>
<td><p>豚骨ラーメンが好き</p></td>
</tr>
<tr class="row-odd"><td><p>Y</p></td>
<td><p>好き</p></td>
<td><p></p></td>
<td><p>豚骨ラーメンが好きです．</p></td>
<td><p>特定のラーメンが好き</p></td>
<td><p>is_known_ramen(#好きなラーメン)</p></td>
<td><p>_set(&amp;topic_ramen,  #好きなラーメン); get_ramen_location(*topic_ramen, &amp;location)</p></td>
<td><p>特定のラーメンが好き</p></td>
</tr>
<tr class="row-even"><td><p>Y</p></td>
<td><p>好き</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>特定のラーメンが好き</p></td>
<td><p>is_novel_ramen(#好きなラーメン)</p></td>
<td><p>_set(&amp;topic_ramen,  #好きなラーメン)</p></td>
<td><p>知らないラーメンが好き</p></td>
</tr>
<tr class="row-odd"><td><p>Y</p></td>
<td><p>好き</p></td>
<td><p></p></td>
<td><p>近所の街中華のラーメンが好きなんだよね</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>#final</p></td>
</tr>
</tbody>
</table>
<p>各行が一つの遷移を示します．</p>
<p><code class="docutils literal notranslate"><span class="pre">flag</span></code>列はは言語理解知識と同じく，その行を使用するかどうかをコンフィギュレーションで規定するためのものです．</p>
<p><code class="docutils literal notranslate"><span class="pre">state</span></code>列は遷移元の状態の名前，<code class="docutils literal notranslate"><span class="pre">next</span> <span class="pre">state</span></code>列は遷移先の状態の名前です．</p>
<p><code class="docutils literal notranslate"><span class="pre">system</span> <span class="pre">utterance</span></code>列はその状態で出力されるシステム発話です．システム発話はその行の遷移とは関係なく，左側の<code class="docutils literal notranslate"><span class="pre">state</span></code>列の値と結びついています．</p>
<p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">utterance</span> <span class="pre">example</span></code>列は，その遷移で想定する発話の例です．実際には使いません．</p>
<p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">utterance</span> <span class="pre">type</span></code>列と<code class="docutils literal notranslate"><span class="pre">conditions</span></code>列はその遷移の条件を表します．以下の場合に遷移の条件が満たされます．</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">utterance</span> <span class="pre">type</span></code>列が空か，または，<code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">utterance</span> <span class="pre">type</span></code>列の値が言語理解結果のユーザ発話タイプがその値と同じで，かつ，</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">conditions</span></code>列が空か，または，<code class="docutils literal notranslate"><span class="pre">conditions</span></code>列のすべての条件が満たされるとき</p></li>
</ul>
<p>これらの条件は，上に書いてある遷移から順に，満たされるかどうかを調べて行きます．</p>
<p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">utterance</span> <span class="pre">type</span></code>列も<code class="docutils literal notranslate"><span class="pre">conditions</span></code>列も空のものをデフォルト遷移と呼びます．基本的に，一つのstateにデフォルト遷移が一つ必要で，そのstateが遷移元になっている行のうち一番下にないといけません．</p>
</section>
<section id="id16">
<h4><span class="section-number">3.4.4.3. </span>条件<a class="headerlink" href="#id16" title="この見出しへのパーマリンク"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">conditions</span></code>列の条件は，関数呼び出しのリストです．関数呼び出しが複数ある場合は，<code class="docutils literal notranslate"><span class="pre">;</span></code>でつなぎます．</p>
<p><code class="docutils literal notranslate"><span class="pre">conditions</span></code>列で使われる関数は，条件関数と呼ばれ，<code class="docutils literal notranslate"><span class="pre">True</span></code>か<code class="docutils literal notranslate"><span class="pre">False</span></code>を返す関数です．すべての関数呼び出しが<code class="docutils literal notranslate"><span class="pre">True</span></code>を返した場合，条件が満たされます．</p>
<p><code class="docutils literal notranslate"><span class="pre">_</span></code>で始まる関数は，組み込み関数です．それ以外の関数は，開発者が作成する関数で，このアプリケーションの場合，<code class="docutils literal notranslate"><span class="pre">scenario_functions.py</span></code>で定義されています．</p>
<p><code class="docutils literal notranslate"><span class="pre">_eq</span></code>は二つの引数の値が同じ文字列なら，<code class="docutils literal notranslate"><span class="pre">True</span></code>を返す組み込み関数です．</p>
<p><code class="docutils literal notranslate"><span class="pre">#好きなラーメン</span></code>のように，<code class="docutils literal notranslate"><span class="pre">#</span></code>で始まる引数は特殊な引数です．例えば言語理解結果のスロット名に<code class="docutils literal notranslate"><span class="pre">#</span></code>をつけたものはスロット値を表す引数です．<code class="docutils literal notranslate"><span class="pre">#好きなラーメン</span></code>は<code class="docutils literal notranslate"><span class="pre">好きなラーメン</span></code>スロットの値です．</p>
<p><code class="docutils literal notranslate"><span class="pre">&quot;豚骨ラーメン&quot;</span></code>のように，<code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>で囲まれた引数はその中の文字列がその値になります．</p>
<p><code class="docutils literal notranslate"><span class="pre">_eq(#好きなラーメン,</span>&#160; <span class="pre">&quot;豚骨ラーメン&quot;)</span></code>は，<code class="docutils literal notranslate"><span class="pre">好きなラーメン</span></code>スロットの値が<code class="docutils literal notranslate"><span class="pre">豚骨ラーメン</span></code>の時に<code class="docutils literal notranslate"><span class="pre">True</span></code>になります．</p>
<p><code class="docutils literal notranslate"><span class="pre">is_known_ramen(#好きなラーメン)</span></code>はシステムが<code class="docutils literal notranslate"><span class="pre">好きなラーメン</span></code>スロットの値を知っていれば<code class="docutils literal notranslate"><span class="pre">True</span></code>を返し，そうでなければ<code class="docutils literal notranslate"><span class="pre">False</span></code>を返すように<code class="docutils literal notranslate"><span class="pre">scenario_functions.py</span></code>の中で定義されています．</p>
<p>条件関数の定義の中では，文脈情報と呼ばれるデータにアクセスすることができます．文脈情報は辞書型のデータで，条件関数や後述のアクション関数の中で，キーを追加することができます．また，あらかじめ値が入っている特殊なキーもあります．詳細は<a class="reference internal" href="05_builtin_blocks.html#context-information"><span class="std std-numref">5.5.4.1 章</span></a>を参照してください．</p>
</section>
<section id="id17">
<h4><span class="section-number">3.4.4.4. </span>アクション<a class="headerlink" href="#id17" title="この見出しへのパーマリンク"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">actionss</span></code>列には，その行の遷移が行われたときに，実行される処理を書きます．これは，関数呼び出しの列です．関数呼び出しが複数ある場合は，<code class="docutils literal notranslate"><span class="pre">;</span></code>でつなぎます．</p>
<p><code class="docutils literal notranslate"><span class="pre">actions</span></code>列で使われる関数は，アクション関数と呼ばれ，何も返しません．</p>
<p>条件関数と同様，<code class="docutils literal notranslate"><span class="pre">_</span></code>で始まる関数は，組み込み関数です．それ以外の関数は，開発者が作成する関数で，このアプリケーションの場合，<code class="docutils literal notranslate"><span class="pre">scenario_functions.py</span></code>で定義されています．</p>
<p><code class="docutils literal notranslate"><span class="pre">_set</span></code>は第2引数の値を第1引数に代入する処理を行います．<code class="docutils literal notranslate"><span class="pre">_set(&amp;topic_ramen,</span>&#160; <span class="pre">#好きなラーメン)</span></code>の第１引数&amp;topic_ramenは，部文脈情報の<code class="docutils literal notranslate"><span class="pre">topic_ramen</span></code>キーの意味で，この関数呼び出しは文脈情報の<code class="docutils literal notranslate"><span class="pre">topic_ramen</span></code>に<code class="docutils literal notranslate"><span class="pre">#好きなラーメン</span></code>スロットの値をセットします．文脈情報の値は，<code class="docutils literal notranslate"><span class="pre">*&lt;キー名&gt;</span></code>で，条件やアクションの中で取り出せます．</p>
<p><code class="docutils literal notranslate"><span class="pre">get_ramen_location(*topic_ramen,</span> <span class="pre">&amp;location)</span></code>は，開発者の作成した関数の呼び出しです．<code class="docutils literal notranslate"><span class="pre">get_ramen_location</span></code>は<code class="docutils literal notranslate"><span class="pre">scenario_functions.py</span></code>で定義されています．この関数は第1引数の値であるラーメンの種類が名物である場所を検索し，文脈情報の第2引数で指定されたキーの値にセットします．例えば<code class="docutils literal notranslate"><span class="pre">topic_ramen</span></code>キーの値が<code class="docutils literal notranslate"><span class="pre">味噌ラーメン</span></code>の場合，味噌ラーメンが名物である場所を検索し，その値が<code class="docutils literal notranslate"><span class="pre">札幌</span></code>であれば，文脈情報の<code class="docutils literal notranslate"><span class="pre">location</span></code>の値を札幌に設定する，という処理を行います．</p>
</section>
<section id="id18">
<h4><span class="section-number">3.4.4.5. </span>遷移の記述のまとめ<a class="headerlink" href="#id18" title="この見出しへのパーマリンク"></a></h4>
<p>まとめると，1行目は，状態が<code class="docutils literal notranslate"><span class="pre">好き</span></code>の時，「豚骨ラーメンとか塩ラーメンなどいろんな種類のラーメンがありますが，どんなラーメンが好きですか？」を発話し，次のユーザの発話の言語理解結果のタイプが<code class="docutils literal notranslate"><span class="pre">特定のラーメンが好き</span></code>で，<code class="docutils literal notranslate"><span class="pre">好きなラーメン</span></code>スロットの値が<code class="docutils literal notranslate"><span class="pre">豚骨ラーメン</span></code>であれば，条件が満たされて遷移が行われ，<code class="docutils literal notranslate"><span class="pre">好きなラーメン</span></code>スロットの値，すなわち，<code class="docutils literal notranslate"><span class="pre">豚骨ラーメン</span></code>が，文脈情報の<code class="docutils literal notranslate"><span class="pre">topic_ramen</span></code>の値にセットされ，<code class="docutils literal notranslate"><span class="pre">豚骨ラーメンが好き</span></code>状態に移行します．条件が満たされない場合，2行目の条件が調べられます．</p>
<p>これを図示すると以下のようになります．</p>
<p><img alt="scenario_graph_simple_ja" src="_images/stn-ja.jpg" /></p>
</section>
<section id="id19">
<h4><span class="section-number">3.4.4.6. </span>特殊な状態名<a class="headerlink" href="#id19" title="この見出しへのパーマリンク"></a></h4>
<p>状態名には特殊なものがあります．</p>
<p><code class="docutils literal notranslate"><span class="pre">#prep</span></code>は，対話が始まる前の状態で，セッション開始後，条件判定とアクションが実行されます．</p>
<p><code class="docutils literal notranslate"><span class="pre">#initial</span></code>は，最初のユーザ発話を生成する状態です．</p>
<p><code class="docutils literal notranslate"><span class="pre">#final</span></code>で始まる名前の状態は，最終状態です．ブロックの出力の<code class="docutils literal notranslate"><span class="pre">final</span></code>に<code class="docutils literal notranslate"><span class="pre">True</span></code>を入れて返すので，対話が終了します．</p>
<p><code class="docutils literal notranslate"><span class="pre">#error</span></code>は，内部エラーが起きた場合に遷移する状態です．これもブロックの出力の<code class="docutils literal notranslate"><span class="pre">final</span></code>に<code class="docutils literal notranslate"><span class="pre">True</span></code>を入れて返します．</p>
</section>
<section id="id20">
<h4><span class="section-number">3.4.4.7. </span>シナリオグラフ<a class="headerlink" href="#id20" title="この見出しへのパーマリンク"></a></h4>
<p>Graphvizがインストールされていれば，アプリケーションを起動したとき，<code class="docutils literal notranslate"><span class="pre">system</span> <span class="pre">utterance</span></code>列のシステム発話と<code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">utterance</span>&#160; <span class="pre">example</span></code>列のユーザ発話例を利用したグラフ(シナリオグラフ<code class="docutils literal notranslate"><span class="pre">_scenario_graph.jpg</span></code>)を出力します．以下が本アプリケーションのシナリオグラフです．</p>
<p><img alt="scenario_graph_simple_ja" src="_images/scenario_graph_simple_ja.jpg" /></p>
</section>
</section>
<section id="n-best">
<h3><span class="section-number">3.4.5. </span>N-Best言語理解結果の利用<a class="headerlink" href="#n-best" title="この見出しへのパーマリンク"></a></h3>
<p>本アプリケーションでは，LR-CRF言語理解ブロックが5-Bestの理解結果を出力するようになっています．これは，コンフィギュレーションファイルの以下の<code class="docutils literal notranslate"><span class="pre">num_candidates</span></code>要素で指定されています．</p>
<div class="highlight-yml notranslate"><div class="highlight"><pre><span></span>blocks:  # bclock list
  - ....
  - name: understander
    ....
    num_candidates: 3
  - ....
</pre></div>
</div>
<p>STN Managerブロックでは，遷移の条件を調べるときに上位の言語理解結果から順に調べ，条件を満たすものがあれば．その結果を用いてアクションを実行して，次の状態に遷移します．</p>
</section>
<section id="id21">
<h3><span class="section-number">3.4.6. </span>シンプルアプリケーションを利用したアプリケーション構築<a class="headerlink" href="#id21" title="この見出しへのパーマリンク"></a></h3>
<section id="id22">
<h4><span class="section-number">3.4.6.1. </span>概要<a class="headerlink" href="#id22" title="この見出しへのパーマリンク"></a></h4>
<p>{}<a class="reference internal" href="#app-development-with-chatgpt-app"><span class="std std-numref">3.3.2 章</span></a>と同様に，シンプルアプリケーションを利用したアプリケーション構築法を説明します．</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sample_apps/simple_ja</span></code>をディレクトリ毎コピーします．DialBBのディレクトリとは全く関係ないディレクトリで構いません．</p></li>
<li><p>各ファイルを編集します．．これらのファイルの名前を変更しても構いません．</p></li>
<li><p>以下のコマンドで起動します．</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span>&lt;DialBBディレクトリ&gt;<span class="p">;</span>python<span class="w"> </span>run_server.py<span class="w"> </span>&lt;コンフィギュレーションファイル&gt;
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id23">
<h4><span class="section-number">3.4.6.2. </span>変更するファイル<a class="headerlink" href="#id23" title="この見出しへのパーマリンク"></a></h4>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">simple-nlu-knowledge-ja.xlsx</span></code></p>
<p>LR-CRF言語理解ブロックで用いる知識を編集します．</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">simple-scenario-ja.xlsx</span></code></p>
<p>シナリオを編集します．</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">scenario_functions.py</span></code></p>
<p>シナリオに付け加えた関数（条件関数，アクション関数）の定義を行います．（<a class="reference internal" href="05_builtin_blocks.html#custom-functions"><span class="std std-numref">5.5.6.4 章</span></a>参照．）</p>
<p>各関数の定義では，シナリオで用いる引数にプラスして，文脈情報を表す辞書型の引数を付加する必要があります．一般的には，<code class="docutils literal notranslate"><span class="pre">context:</span> <span class="pre">Dict[str,</span> <span class="pre">Any]</span></code>とします．文脈情報には，あらかじめ登録されている情報と対話中にアクション関数によって登録される情報があります．詳細は<a class="reference internal" href="05_builtin_blocks.html#context-information"><span class="std std-numref">5.5.4.1 章</span></a>を見てください．</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">config.yml</span></code></p>
<p>基本的な機能のみを用いるならば，あまり変更する必要はないと思います．</p>
</li>
</ul>
</section>
</section>
</section>
<section id="id24">
<h2><span class="section-number">3.5. </span>実験アプリケーション<a class="headerlink" href="#id24" title="この見出しへのパーマリンク"></a></h2>
<section id="id25">
<h3><span class="section-number">3.5.1. </span>概要<a class="headerlink" href="#id25" title="この見出しへのパーマリンク"></a></h3>
<p>ChatGPTによる言語理解・固有表現抽出とネットワークベース対話管理を軸に，組み込みブロックの様々な機能を含んでいるものです．以下の組み込みブロックを用いています．</p>
<ul class="simple">
<li><p><a class="reference internal" href="05_builtin_blocks.html#japanese-canonicalizer"><span class="std std-ref">Japanese Canonicalizer （日本語文字列正規化ブロック）</span></a></p></li>
<li><p><a class="reference internal" href="05_builtin_blocks.html#chatgpt-understander"><span class="std std-ref">ChatGPT Understander （ChatGPTを用いた言語理解ブロック）</span></a></p></li>
<li><p><a class="reference internal" href="05_builtin_blocks.html#chatgpt-ner"><span class="std std-ref">ChatGPT NER （ChatGPTを用いた固有表現抽出ブロック）</span></a></p></li>
<li><p><a class="reference internal" href="05_builtin_blocks.html#stn-manager"><span class="std std-ref">STN manager （状態遷移ネットワークベースの対話管理ブロック）</span></a></p></li>
</ul>
<p>シンプルアプリケーションとの大きな違いは，ChatGPT言語理解ブロックとChatGPT固有表現抽出ブロックを用いているところと，STN Managerブロックの先進的な機能を用いているところです．</p>
</section>
<section id="id26">
<h3><span class="section-number">3.5.2. </span>アプリケーションを構成するファイル<a class="headerlink" href="#id26" title="この見出しへのパーマリンク"></a></h3>
<p>本アプリケーションを構成するファイルは<code class="docutils literal notranslate"><span class="pre">sample_apps/simple_ja</span></code>ディレクトリ（フォルダ）にあります．そのディレクトリには以下のファイルが含まれています．</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">config.yml</span></code></p>
<p>アプリケーションを規定するコンフィギュレーションファイルです．</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">lab_app_nlu_knowledge_ja.xlsx</span></code></p>
<p>ChatGPT言語理解ブロックで用いる知識を記述したものです．</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">lab_app_ner_knowledge_ja.xlsx</span></code></p>
<p>ChatGPT固有表現抽出ブロックで用いる知識を記述したものです．</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">lab_app_scenario_ja.xlsx</span></code></p>
<p>STN Managerブロックで用いる知識を記述したものです．</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">scenario_functions.py</span></code></p>
<p>STN Managerブロックで用いるプログラムです</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">test_requests.json</span></code></p>
<p>テストリクエスト（<a class="reference internal" href="04_framework.html#test-requests"><span class="std std-numref">4.7 章</span></a>）のファイルです．</p>
</li>
</ul>
</section>
<section id="id27">
<h3><span class="section-number">3.5.3. </span>ChatGPT言語理解ブロック<a class="headerlink" href="#id27" title="この見出しへのパーマリンク"></a></h3>
<p>ChatGPTのJSONモードを用いて言語理解を行います．言語理解用の知識はLR-CRF言語理解ブロックと同じ形式のものを用います．これをFew-shot learningに用いて，入力テキストに対して言語理解を行います．入出力LR-CRF言語理解ブロックも同じです．</p>
<p>GPTのモデルは，ブロックコンフィギュレーションの<code class="docutils literal notranslate"><span class="pre">gpt_model</span></code>で指定しています．</p>
<p>ChatGPTに言語理解を行わせる場合のプロンプトのテンプレートはデフォルトのものを用いていいます．詳細は<code class="xref std std-numref docutils literal notranslate"><span class="pre">chatgpt_understander_params</span></code>を参照してください．</p>
</section>
<section id="id28">
<h3><span class="section-number">3.5.4. </span>ChatGPT固有表現抽出ブロック<a class="headerlink" href="#id28" title="この見出しへのパーマリンク"></a></h3>
<p>ChatGPTを用いて固有表現抽出を行います．抽出した結果は，ブロックの出力の<code class="docutils literal notranslate"><span class="pre">aux_data</span></code>に入れて返します．以下が例です．</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;NE_人名&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;田中&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;NE_地名&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;札幌&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">人名</span></code>や<code class="docutils literal notranslate"><span class="pre">地名</span></code>は以下に述べる固有表現抽出知識で定義されている固有表現のクラスです．この結果はSTN Managerブロックの中で，<code class="docutils literal notranslate"><span class="pre">#NE_人名</span></code>や<code class="docutils literal notranslate"><span class="pre">#NE_地名</span></code>という特殊変数で取り出すことができます．</p>
<section id="id29">
<h4><span class="section-number">3.5.4.1. </span>固有表現抽出知識<a class="headerlink" href="#id29" title="この見出しへのパーマリンク"></a></h4>
<p>ChatGPT固有表現抽出ブロックが用いる知識は，<code class="docutils literal notranslate"><span class="pre">simple-ner-knowledge-ja.xlsx</span></code>に書かれています．固有表現抽出知識の記述法の詳細は<a class="reference internal" href="05_builtin_blocks.html#chatgpt-ner-knowledge"><span class="std std-numref">5.7.3 章</span></a>を参照してください．以下に簡単に説明します．</p>
<p>固有表現抽出知識は，以下の2つのシートからなります．</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>シート名</p></th>
<th class="head"><p>内容</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>utterances</p></td>
<td><p>発話例と，その発話例から抽出されるべき固有表現</p></td>
</tr>
<tr class="row-odd"><td><p>classes</p></td>
<td><p>固有表現のクラスの説明とそのクラスの固有表現の例</p></td>
</tr>
</tbody>
</table>
<p>utterancesシートの一部を以下に示します．</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>flag</p></th>
<th class="head"><p>utterance</p></th>
<th class="head"><p>entities</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Y</p></td>
<td><p>札幌の味噌ラーメンが好きです</p></td>
<td><p>地名=札幌</p></td>
</tr>
<tr class="row-odd"><td><p>Y</p></td>
<td><p>田中です</p></td>
<td><p>人名=田中</p></td>
</tr>
<tr class="row-even"><td><p>Y</p></td>
<td><p>太郎は東京に住んでます</p></td>
<td><p>人名=太郎，地名=東京</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">flag</span></code>列は，その行を使用するかどうかをコンフィギュレーションで規定するためのものです．</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">utterance</span></code>列は発話例です．</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">entities</span></code>には，<code class="docutils literal notranslate"><span class="pre">&lt;固有表現クラス名&gt;=&lt;固有表現&gt;,</span> <span class="pre">...</span> <span class="pre">,&lt;固有表現クラス名&gt;=&lt;固有表現&gt;</span></code>の形で発話に含まれるスロットを書きます．カンマは全角でも読点でも構いません．</p></li>
</ul>
<p>以下は<code class="docutils literal notranslate"><span class="pre">classes</span></code>シートの例です．固有表現のクラス毎に1行記述します．</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>flag</p></th>
<th class="head"><p>class</p></th>
<th class="head"><p>explanation</p></th>
<th class="head"><p>examples</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Y</p></td>
<td><p>人名</p></td>
<td><p>人の名前</p></td>
<td><p>田中，山田，太郎，花子，ジョン</p></td>
</tr>
<tr class="row-odd"><td><p>Y</p></td>
<td><p>地名</p></td>
<td><p>場所の名前</p></td>
<td><p>札幌，東京，大阪，日本，アメリカ，北海道</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">flag</span></code>列は，<code class="docutils literal notranslate"><span class="pre">utterances</span></code>シートと同じです．</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">class</span></code>列には固有表現のクラスを書きます．</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">explanation</span></code>列には固有表現の説明を書きます．</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">examples</span></code>列には，そのクラスの固有表現の例をカンマまたは読点で並べて書きます．</p></li>
</ul>
</section>
</section>
<section id="id30">
<h3><span class="section-number">3.5.5. </span>STN Managerの機能<a class="headerlink" href="#id30" title="この見出しへのパーマリンク"></a></h3>
<p>実験アプリケーションでは，シンプルアプリケーションでは用いていない以下のSTN Managerの機能を使っています．</p>
<section id="id31">
<h4><span class="section-number">3.5.5.1. </span>システム発話中の関数呼び出し・特殊変数参照<a class="headerlink" href="#id31" title="この見出しへのパーマリンク"></a></h4>
<p>シンプルアプリケーションでは，システム発話中には，文脈情報の変数しか埋め込んでいませんでしたが，関数呼び出しや特殊変数も埋め込むことができます．</p>
<p>例えば，</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>私は{get_system_name()}です．よろしければお名前を教えて頂けますか？
</pre></div>
</div>
<p>の場合，<code class="docutils literal notranslate"><span class="pre">scenario_fuctions.py</span></code>で定義されている<code class="docutils literal notranslate"><span class="pre">get_system_name(context)</span></code>が呼ばれ，その返り値（文字列）が<code class="docutils literal notranslate"><span class="pre">{get_system_name()}</span></code>に置き換わります．なお，<code class="docutils literal notranslate"><span class="pre">get_system_name</span></code>は，コンフィギュレーションファイルの<code class="docutils literal notranslate"><span class="pre">system_name</span></code>の値を返すように定義されています．</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ありがとうございます．{#NE_人名}さん，今日はラーメンについて教えて下さい．ラーメンはよく食べますか？
</pre></div>
</div>
<p>の場合，<code class="docutils literal notranslate"><span class="pre">{#NE_人名}</span></code>は，特殊変数<code class="docutils literal notranslate"><span class="pre">#NE_人名</span></code>の値で置き換えられます．<code class="docutils literal notranslate"><span class="pre">#NE_人名</span></code>はaux_dataの<code class="docutils literal notranslate"><span class="pre">NE_人名</span></code>の値，すなわち固有表現抽出の人名の値になります．</p>
</section>
<section id="id32">
<h4><span class="section-number">3.5.5.2. </span>シンタクスシュガー<a class="headerlink" href="#id32" title="この見出しへのパーマリンク"></a></h4>
<p>シナリオ内で組み込み関数呼び出しを簡単に記述するためのシンタクスシュガーが用意されています．たとえば<code class="docutils literal notranslate"><span class="pre">confirmation_request=&quot;すみません．ラーメンってよく食べますか？&quot;</span></code>は<code class="docutils literal notranslate"><span class="pre">_set(&amp;confirmation_request,</span> <span class="pre">&quot;すみません．ラーメンってよく食べますか？&quot;)</span></code>と同じです．</p>
<p><code class="docutils literal notranslate"><span class="pre">#好きなラーメン==&quot;豚骨ラーメン&quot;</span></code>は，<code class="docutils literal notranslate"><span class="pre">_eq(#好きなラーメン,</span> <span class="pre">&quot;豚骨ラーメン&quot;)</span></code>と同じで，<code class="docutils literal notranslate"><span class="pre">#NE_人名!=&quot;&quot;</span></code>は，<code class="docutils literal notranslate"><span class="pre">_ne(#NE_人名,</span> <span class="pre">&quot;&quot;)</span></code>と同じです．</p>
</section>
<section id="id33">
<h4><span class="section-number">3.5.5.3. </span>リアクション発話生成<a class="headerlink" href="#id33" title="この見出しへのパーマリンク"></a></h4>
<p>シナリオのactions欄に<code class="docutils literal notranslate"><span class="pre">_reaction=&quot;そうなんですね．&quot;</span></code>があります．_reactionは文脈情報の特殊な変数で，次のシステム発話の先頭にこの変数の値を付加します．たとえば，この後状態<code class="docutils literal notranslate"><span class="pre">好き</span></code>に遷移すると，システム発話<code class="docutils literal notranslate"><span class="pre">豚骨ラーメンとか塩ラーメンなどいろんな種類のラーメンがありますが，どんなラーメンが好きですか？</span></code>の先頭に，<code class="docutils literal notranslate"><span class="pre">そうなんですね．</span></code>が付加され，<code class="docutils literal notranslate"><span class="pre">そうなんですね．豚骨ラーメンとか塩ラーメンなどいろんな種類のラーメンがありますが，どんなラーメンが好きですか？</span></code>が発話されます．</p>
<p>このようにユーザ発話に対するリアクションを与えることで，ユーザの言ったことを聞いているよ，ということを示すことができ，ユーザ体験が良くなります．</p>
</section>
<section id="id34">
<h4><span class="section-number">3.5.5.4. </span>ChatGPTを用いた発話生成・条件判定<a class="headerlink" href="#id34" title="この見出しへのパーマリンク"></a></h4>
<p>システム発話中にある，<code class="docutils literal notranslate"><span class="pre">$&quot;それまでの会話につづけて，対話を終わらせる発話を50文字以内で生成してください．&quot;</span></code>は，組み込み関数呼び出し<code class="docutils literal notranslate"><span class="pre">_check_with_llm(&quot;それまでの会話につづけて，対話を終わらせる発話を50文字以内で生成してください．&quot;}</span></code>のシンタクスシュガーで，ChatGPTを用いて発話を生成します．</p>
<p>また，conditions欄にある<code class="docutils literal notranslate"><span class="pre">$&quot;ユーザが理由を言ったかどうか判断してください．&quot;</span></code>は，組み込み関数呼び出し<code class="docutils literal notranslate"><span class="pre">_check_with_llm(&quot;ユーザが理由を言ったかどうか判断してください．&quot;)</span></code>のシンタクスシュガーで，これまでの対話からChatGPTを用いて判定を行い，bool値で返します．</p>
<p>発話を生成する際のChatGPTのモデルや温度パラメータ，状況設定，ペルソナはブロックコンフィギュレーションで以下のように指定されています．</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">chatgpt</span><span class="p">:</span>
<span class="w">  </span><span class="nt">gpt_model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpt-4o-mini</span>
<span class="w">  </span><span class="nt">temperature</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.7</span>
<span class="w">  </span><span class="nt">situation</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">あなたは対話システムで，ユーザと食べ物に関して雑談をしています．</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ユーザとは初対面です</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ユーザとは同年代です</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ユーザとは親しい感じで話します</span>
<span class="w">  </span><span class="nt">persona</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">名前は由衣</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">28歳</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">女性</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ラーメン全般が好き</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">お酒は飲まない</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IT会社のwebデザイナー</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">独身</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">非常にフレンドリーに話す</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">外交的で陽気</span>
</pre></div>
</div>
</section>
<section id="id35">
<h4><span class="section-number">3.5.5.5. </span>サブダイアローグ<a class="headerlink" href="#id35" title="この見出しへのパーマリンク"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">next</span> <span class="pre">state</span></code>欄に<code class="docutils literal notranslate"><span class="pre">#gosub:確認:ラーメン食べるか確認完了</span></code>があります．これは，<code class="docutils literal notranslate"><span class="pre">確認</span></code>状態に遷移して対話を行った後，<code class="docutils literal notranslate"><span class="pre">ラーメン食べるか確認完了</span></code>状態に戻るという意味です．<code class="docutils literal notranslate"><span class="pre">確認</span></code>状態から始まる対話をサブダイアローグと呼びます．サブダイアローグが<code class="docutils literal notranslate"><span class="pre">#exit</span></code>状態に移行すると，サブダイアローグから抜けて，<code class="docutils literal notranslate"><span class="pre">ラーメン食べるか確認完了</span></code>状態に行きます．</p>
<p>ユーザに確認を行うような，いろいろな場面で再利用可能な対話を，サブダイアローグとして用意しておくことで，シナリオ記述を減らすことが可能です．</p>
</section>
<section id="id36">
<h4><span class="section-number">3.5.5.6. </span>スキップ遷移<a class="headerlink" href="#id36" title="この見出しへのパーマリンク"></a></h4>
<p>system utterance欄に<code class="docutils literal notranslate"><span class="pre">$skip</span></code>があるとシステム発話を返さず，すぐに条件判定を行って次の遷移を行います．アクションの結果をもとにさらに遷移先を変えたいときなどに使います．</p>
</section>
<section id="id37">
<h4><span class="section-number">3.5.5.7. </span>リピート機能<a class="headerlink" href="#id37" title="この見出しへのパーマリンク"></a></h4>
<p>ブロックコンフィギュレーションで<code class="docutils literal notranslate"><span class="pre">repeat_when_no_available_transitions</span></code>が指定されています．これが指定されているとき，条件を満たす遷移がなければ，元の状態に戻って同じ発話を繰り返します．この場合，デフォルト遷移がない状態があっても構いません．本アプリケーションの場合，<code class="docutils literal notranslate"><span class="pre">好き</span></code>状態にはデフォルト遷移がないので，この状態で全く関係ない発話をした場合には，同じシステム発話が繰り返されます．</p>
</section>
<section id="id38">
<h4><span class="section-number">3.5.5.8. </span>音声入力に対処するための機能<a class="headerlink" href="#id38" title="この見出しへのパーマリンク"></a></h4>
<p>STN Managerには音声入力に対処するための機能があり，ブロックコンフィギュレーションで設定することで利用できます．本アプリケーションでは以下のように設定しています．</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">input_confidence_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="nt">confirmation_request</span><span class="p">:</span>
<span class="w">  </span><span class="nt">function_to_generate_utterance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">generate_confirmation_request</span>
<span class="w">  </span><span class="nt">acknowledgement_utterance_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">肯定</span>
<span class="w">  </span><span class="nt">denial_utterance_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">否定</span>
<span class="nt">ignore_out_of_context_barge_in</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="nt">reaction_to_silence</span><span class="p">:</span>
<span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">repeat</span>
</pre></div>
</div>
<p>これらの意味は<a class="reference internal" href="05_builtin_blocks.html#handling-speech-input"><span class="std std-numref">5.5.11 章</span></a>を見てください．</p>
<p><code class="docutils literal notranslate"><span class="pre">test_requests.json</span></code>には音声入力に対応した入力の例が入っています．</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="02_concept.html" class="btn btn-neutral float-left" title="2. DialBBの概要" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="04_framework.html" class="btn btn-neutral float-right" title="4. フレームワーク仕様" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright C4A Research Institute, Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>